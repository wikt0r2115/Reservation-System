<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Rezerwacje â€“ System</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

</head>
<body class="bg-light">

<div class="container py-4">
    <h1 class="mb-4 text-center">ðŸ“… ZarzÄ…dzanie Rezerwacjami</h1>

    <!-- FORMULARZ DODAWANIA REZERWACJI -->
    <div class="card mb-4">
        <div class="card-header">Dodaj nowÄ… rezerwacjÄ™</div>
        <div class="card-body">

            <form id="reservationForm">
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label">ID uÅ¼ytkownika</label>
                        <input type="number" class="form-control" id="userId" required>
                    </div>
                    <div class="col">
                        <label class="form-label">ID mieszkania</label>
                        <input type="number" class="form-control" id="accommodationId" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label">Data rozpoczÄ™cia</label>
                        <input type="date" class="form-control" id="startDate" required>
                    </div>
                    <div class="col">
                        <label class="form-label">Data zakoÅ„czenia</label>
                        <input type="date" class="form-control" id="endDate" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Status</label>
                    <input type="text" class="form-control" id="status" value="CONFIRMED" required>
                </div>

                <button type="submit" class="btn btn-primary w-100">Zapisz rezerwacjÄ™</button>
            </form>

            <div id="createResult" class="mt-3"></div>
        </div>
    </div>

    <!-- LISTA REZERWACJI -->
    <div class="card">
        <div class="card-header">Lista rezerwacji</div>
        <div class="card-body">

            <button class="btn btn-success mb-3" onclick="loadReservations()">ðŸ”„ OdÅ›wieÅ¼ listÄ™</button>

            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>UserID</th>
                    <th>AccommodationID</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Created</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody id="reservationTableBody"></tbody>
            </table>

        </div>
    </div>

</div>

<script>
    const API_URL = "http://localhost:8080/reservation";

    // ------- DODAWANIE REZERWACJI -------
    document.getElementById("reservationForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const reservation = {
            userId: document.getElementById("userId").value,
            accommodationId: document.getElementById("accommodationId").value,
            startDate: document.getElementById("startDate").value,
            endDate: document.getElementById("endDate").value,
            createdAt: new Date().toISOString().split("T")[0],
            status: document.getElementById("status").value
        };

        const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(reservation)
        });

        if (res.ok) {
            document.getElementById("createResult").innerHTML =
                `<div class="alert alert-success">Rezerwacja dodana!</div>`;
            loadReservations();
        } else {
            document.getElementById("createResult").innerHTML =
                `<div class="alert alert-danger">BÅ‚Ä…d: HTTP ${res.status}</div>`;
        }
    });

    // ------- WCZYTYWANIE LISTY REZERWACJI -------
    async function loadReservations() {
        const res = await fetch(API_URL);

        if (!res.ok) {
            alert("BÅ‚Ä…d Å‚adowania rezerwacji.");
            return;
        }

        const data = await res.json();
        const body = document.getElementById("reservationTableBody");
        body.innerHTML = "";

        data.forEach(r => {
            body.innerHTML += `
                <tr>
                    <td>${r.id}</td>
                    <td>${r.userId}</td>
                    <td>${r.accommodationId}</td>
                    <td>${r.startDate}</td>
                    <td>${r.endDate}</td>
                    <td>${r.createdAt}</td>
                    <td>${r.status}</td>
                </tr>`;
        });
    }

    // Automatycznie zaÅ‚aduj przy starcie
    loadReservations();
</script>

</body>
</html>
